# –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü Cities

## üéØ –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cities` - –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≥–æ—Ä–æ–¥–∞**
**–ü—Ä–∏—á–∏–Ω–∞:** –ì–∏–¥—ã –∏–º–µ–ª–∏ `approved: true`, –Ω–æ –∫–æ–¥ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –ø–æ `status === 'approved'`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö –ø–æ–ª–µ–π: `status === 'approved'` –ò–õ–ò `approved === true`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤ –±–µ–∑ –≥–∏–¥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cities/[slug]` - –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª–∞—Å—å**
**–ü—Ä–∏—á–∏–Ω–∞:** –í Next.js 16 –ø–∞—Ä–∞–º–µ—Ç—Ä `params` —Å—Ç–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º Promise

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ë—ã–ª–æ:
params: { slug: string }
const slug = params?.slug;

// –°—Ç–∞–ª–æ:
params: Promise<{ slug: string }>
const { slug } = await params;
```

### 3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –≤ –ë–î**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `base_price_4h`, `themes`, –Ω–æ –≤ –ë–î –æ–Ω–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è `price_4h`, `experience_tags`

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–µ–Ω–æ `base_price_4h/6h/8h` ‚Üí `price_4h/6h/8h`
- –ó–∞–º–µ–Ω–µ–Ω–æ `themes` ‚Üí `experience_tags`
- –ê–¥–∞–ø—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `lib/data-service.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ `getCitiesWithMeta()` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `approved` –≤ SELECT, —Ñ–∏–ª—å—Ç—Ä –ø–æ `approved === true`
2. ‚úÖ `getCity()` - –ø–æ–¥—Å—á–µ—Ç –≥–∏–¥–æ–≤ —Å `.or('status.eq.approved,approved.eq.true')`
3. ‚úÖ `getGuidesWithMeta()` - —Ñ–∏–ª—å—Ç—Ä –ø–æ `status` –ò–õ–ò `approved`
4. ‚úÖ `searchGuides()` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `experience_tags` –∏ `approved`
5. ‚úÖ `getTopGuides()` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `approved`
6. ‚úÖ –í—Å–µ `base_price_*` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `price_*`
7. ‚úÖ –í—Å–µ `themes` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `experience_tags`
8. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤ —Å 0 –≥–∏–¥–∞–º–∏

### `lib/adapters.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: `price_*` –∏ `base_price_*`
2. ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: `experience_tags` –∏ `themes`
3. ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏

### `app/cities/[slug]/page.tsx`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `params: Promise<{ slug: string }>`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `await` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è slug: `const { slug } = await params;`

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π –≤ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `guides`
```typescript
{
  id: string
  city_id: string
  headline: string | null
  tagline: string | null
  bio: string | null
  experience_tags: string[] | null  // ‚Üê –ù–ï themes
  price_4h: string | null           // ‚Üê –ù–ï base_price_4h
  price_6h: string | null           // ‚Üê –ù–ï base_price_6h
  price_8h: string | null           // ‚Üê –ù–ï base_price_8h
  hourly_rate: string | null
  currency: string | null
  status: 'pending' | 'approved' | 'rejected' | null
  approved: boolean                 // ‚Üê –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  verification_status: string | null
  slug: string | null
  created_at: string
  updated_at: string
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. `scripts/test-cities-query.ts` - —Ç–µ—Å—Ç —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤
2. `scripts/test-cities-with-approved.ts` - —Ç–µ—Å—Ç —Å –ø–æ–ª–µ–º approved
3. `scripts/test-city-page.ts` - —Ç–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
export $(cat .env.local | xargs)
npx tsx scripts/test-city-page.ts berlin
npx tsx scripts/test-city-page.ts paris
npx tsx scripts/test-cities-with-approved.ts
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cities`
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ 9 –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∏–¥–æ–≤:
  - Berlin: 2 guides
  - London: 2 guides
  - Paris: 2 guides
  - Amsterdam, Barcelona, Madrid, Prague, Rome, Vienna: –ø–æ 1 guide

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cities/[slug]` (–Ω–∞–ø—Ä–∏–º–µ—Ä `/cities/berlin`)
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Ä–æ–¥–µ
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –≥–∏–¥—ã –≥–æ—Ä–æ–¥–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ü–µ–Ω—ã, —Ç–µ–≥–∏, –æ–ø–∏—Å–∞–Ω–∏—è

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í `getCitiesWithMeta()` –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:
```javascript
console.log(`[getCities] City: ${city.name}`, {
  totalGuidesFromDB: allGuides.length,
  approvedCount: approvedGuides.length,
  guides: allGuides.map((g: any) => ({ 
    id: g.id?.substring(0, 8), 
    status: g.status,
    approved: g.approved 
  })),
  country: city.country,
});
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
–ê–¥–∞–ø—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–ª–µ–π:
- `price_*` (—Ç–µ–∫—É—â–∏–π) –∏ `base_price_*` (legacy)
- `experience_tags` (—Ç–µ–∫—É—â–∏–π) –∏ `themes` (legacy)
- `approved` (—Ç–µ–∫—É—â–∏–π) –∏ `status` (legacy)

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã –≥–æ—Ä–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
2. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∏–¥–æ–≤
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª–µ–π –≥–∏–¥–æ–≤ `/guides/[slug]`
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –ø–æ–∏—Å–∫
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìå –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–ü–æ–ª–µ `approved`** - –æ—Å–Ω–æ–≤–Ω–æ–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≥–∏–¥–∞
2. **–ü–æ–ª–µ `status`** - –º–æ–∂–µ—Ç –±—ã—Ç—å `null` –∏–ª–∏ `'pending'`, –Ω–æ `approved: true` –æ–∑–Ω–∞—á–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω
3. **–ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `price_*`, –∞ –Ω–µ `base_price_*`
4. **–¢–µ–≥–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `experience_tags`, –∞ –Ω–µ `themes`
5. **Next.js 16** - –≤—Å–µ dynamic params —Ç–µ–ø–µ—Ä—å Promise –∏ —Ç—Ä–µ–±—É—é—Ç `await`
