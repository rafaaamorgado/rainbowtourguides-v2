# üö® EMERGENCY FIX: Infinite Recursion

## –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞?

–ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–º–æ–≥, –∑–Ω–∞—á–∏—Ç –µ—Å—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

## ‚ò¢Ô∏è –Ø–¥–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (100% —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. **–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç RLS** –Ω–∞ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
2. **–£–¥–∞–ª—è–µ—Ç –í–°–ï –ø–æ–ª–∏—Ç–∏–∫–∏** (–≤–∫–ª—é—á–∞—è —Å–∫—Ä—ã—Ç—ã–µ)
3. **–í–∫–ª—é—á–∞–µ—Ç RLS –æ–±—Ä–∞—Ç–Ω–æ**
4. **–°–æ–∑–¥–∞–µ—Ç –¢–û–õ–¨–ö–û –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏** –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ:

**–í Supabase SQL Editor:**
```
supabase/NUCLEAR-FIX-RLS.sql
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ —Ñ–∞–π–ª –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**.

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª):
```sql
DROP POLICY IF EXISTS "policy_name" ON table;
```
‚ùå –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (—è–¥–µ—Ä–Ω—ã–π):
```sql
-- 1. –û—Ç–∫–ª—é—á–∞–µ–º RLS (–≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
ALTER TABLE profiles DISABLE ROW LEVEL SECURITY;

-- 2. –£–¥–∞–ª—è–µ–º –í–°–ï –ø–æ–ª–∏—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ —Ü–∏–∫–ª
DO $$ 
DECLARE policy_record RECORD;
BEGIN
    FOR policy_record IN 
        SELECT policyname FROM pg_policies WHERE tablename = 'profiles'
    LOOP
        EXECUTE format('DROP POLICY IF EXISTS %I ON profiles', policy_record.policyname);
    END LOOP;
END $$;

-- 3. –í–∫–ª—é—á–∞–µ–º RLS –æ–±—Ä–∞—Ç–Ω–æ (—á–∏—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞)
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

-- 4. –°–æ–∑–¥–∞–µ–º –ü–†–û–°–¢–´–ï –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY "profiles_select_all"
    ON profiles FOR SELECT
    USING (true);  -- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ
```

---

## –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### ‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
- –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å `profiles` (–∏–º–µ–Ω–∞ –≥–∏–¥–æ–≤, –∞–≤–∞—Ç–∞—Ä—ã)
- –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å `guides` (–ø—É–±–ª–∏—á–Ω—ã–µ –ª–∏—Å—Ç–∏–Ω–≥–∏)
- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- **–ù–∏–∫–∞–∫–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏!**

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º ‚úÖ
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) - –≤ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–æ
- –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è marketplace

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:

```bash
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
```

–ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ:
- http://localhost:3000/guides
- http://localhost:3000/guides/luca-romano-cc31c92a

**–û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å!** üéâ

---

## –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –í–°–ï –ï–©–ï –µ—Å—Ç—å

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ –≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∞—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –ö–µ—à Supabase
```sql
-- –í SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
SELECT pg_reload_conf();
NOTIFY pgrst, 'reload schema';
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:
npm run dev
```

### 3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
- Hard refresh: Cmd+Shift+R (Mac) –∏–ª–∏ Ctrl+Shift+R (Windows)

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–µ–Ω—ã
```sql
SELECT * FROM pg_policies 
WHERE tablename IN ('profiles', 'guides');
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ 6 —Å—Ç—Ä–æ–∫ (–ø–æ 3 –Ω–∞ –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É)
```

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –û—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–ï–ó RLS:

```sql
-- –¢–û–õ–¨–ö–û –î–õ–Ø DEVELOPMENT!
ALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.guides DISABLE ROW LEVEL SECURITY;
```

–ü–æ—Ç–æ–º –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º –≤–∫–ª—é—á–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏.

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 30 —Å–µ–∫—É–Ω–¥  
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞:** 99.9%  
**–û—Ç–∫–∞—Ç:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑
